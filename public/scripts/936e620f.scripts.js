"use strict";angular.module("videogelApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/",{templateUrl:"partials/main",controller:"MainCtrl"}).when("/login",{templateUrl:"partials/login",controller:"LoginCtrl"}).when("/signup",{templateUrl:"partials/signup",controller:"SignupCtrl"}).when("/settings",{templateUrl:"partials/settings",controller:"SettingsCtrl",authenticate:!0}).when("/slideshow",{templateUrl:"partials/slideshow",controller:"SlideshowCtrl",authenticate:!0}).when("/create-video-slideshow/select-photos-from/smugmug",{templateUrl:"partials/create",controller:"CreateCtrl",authenticate:!0}).when("/create-video-slideshow/select-photos-from/smugmug/select-thumbnails-for-album/:albumid",{templateUrl:"partials/thumbnails",controller:"ThumbnailsCtrl",authenticate:!0}).when("/slideshow",{templateUrl:"partials/slideshow",controller:"SlideshowCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0),c.interceptors.push(["$q","$location",function(a,b){return{responseError:function(c){return 401===c.status?(b.path("/login"),a.reject(c)):a.reject(c)}}}])}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(a,d){d.authenticate&&!c.isLoggedIn()&&b.path("/login")})}]),angular.module("videogelApp").controller("MainCtrl",["$scope","$http",function(a,b){b.get("/api/awesomeThings").success(function(b){a.awesomeThings=b})}]),angular.module("videogelApp").controller("NavbarCtrl",["$scope","$location","Auth",function(a,b,c){a.menu=[{title:"Home",link:"/"},{title:"Create",link:"/create-video-slideshow/select-photos-from/smugmug"},{title:"Slideshow",link:"/slideshow"},{title:"Settings",link:"/settings"}],a.logout=function(){c.logout().then(function(){b.path("/login")})},a.isActive=function(a){return a===b.path()}}]),angular.module("videogelApp").controller("LoginCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.loginSmugmug=function(){window.location.href="/auth/smugmug"},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")}).catch(function(b){b=b.data,a.errors.other=b.message})}}]),angular.module("videogelApp").controller("SignupCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")}).catch(function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})}}]),angular.module("videogelApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."}).catch(function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password"})}}]),angular.module("videogelApp").controller("CreateCtrl",["$scope","$http","Createslideshow",function(a,b,c){a.albums=c.albums,a.stats=c.stats,a.itemClicked=function(){if(this.album.selected=!this.album.selected,this.album.selected){var a=this.album.Images,b=_.filter(a,function(a){return a.selected});0===b.length&&_.each(a,function(a){a.selected=!0})}c.stats.selectedImageCount=c.getSelectedImageCount(),c.saveSelections()},a.finishedSelecting=function(){},a.saveSelections=function(){c.saveSelections()}}]),angular.module("videogelApp").controller("ThumbnailsCtrl",["$scope","$http","$routeParams","Createslideshow",function(a,b,c,d){function e(){a.album=_.find(a.albums,function(a){return a.id===g}),a.album&&(a.images=a.album.Images,a.images=_.sortBy(a.images,"FileName"))}function f(){return a.albumSelectedImagesCount=_.filter(a.images,function(a){return a.selected}).length,a.albumSelectedImagesCount}var g=parseInt(c.albumid);a.albums=d.albums,a.stats=d.stats,e(),f(),a.$watch("albums",function(){e(),f()},!0),a.thumbClicked=function(){this.image.selected=!this.image.selected,d.stats.selectedImageCount=d.getSelectedImageCount(),f(),d.saveSelections()},a.finishedSelecting=function(){}}]),angular.module("videogelApp").factory("Auth",["$location","$rootScope","Session","User","$cookieStore",function(a,b,c,d,e){return b.currentUser=e.get("user")||null,e.remove("user"),{login:function(a,d){var e=d||angular.noop;return c.save({email:a.email,password:a.password},function(a){return b.currentUser=a,e()},function(a){return e(a)}).$promise},logout:function(a){var d=a||angular.noop;return c.delete(function(){return b.currentUser=null,d()},function(a){return d(a)}).$promise},createUser:function(a,c){var e=c||angular.noop;return d.save(a,function(a){return b.currentUser=a,e(a)},function(a){return e(a)}).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.update({oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},currentUser:function(){return d.get()},isLoggedIn:function(){var a=b.currentUser;return!!a}}}]),angular.module("videogelApp").factory("Session",["$resource",function(a){return a("/api/session/")}]),angular.module("videogelApp").factory("User",["$resource",function(a){return a("/api/users/:id",{id:"@id"},{update:{method:"PUT",params:{}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("videogelApp").service("Createslideshow",["$http",function(a){var b=this;b.albums=[],b.stats={selectedImageCount:0,selectedImageCountByAlbum:[]},a.get("/api/smugmug/albums").success(function(c){$(".progress-overlay").show(),_.each(c,function(c){c.selected=!1;var d={albumID:c.id,albumKey:c.Key},e="/api/smugmug/images/?",f=e+querystring.stringify(d);a.get(f).success(function(a){_.each(a,function(a){a.selected=!1}),c.Images=a,b.albums.push(c),b.getSelections(c)})})}),b.getSelections=function(c){var d="/api/smugmug/selections";a.get(d).success(function(a){var d=_.find(a,function(a){return a.id===c.id});d&&(c.selected=d.selected,_.each(c.Images,function(a){var b=_.find(d.Images,function(b){return a.id===b.id});b&&(a.selected=!0)})),$(".progress-overlay").hide(),b.stats.selectedImageCount=b.getSelectedImageCount()})},b.saveSelections=function(){var c=b.albums,d=[];_.each(c,function(a){var b={};b.id=a.id,b.Key=a.Key,b.selected=a.selected,b.Images=[];var c=_.filter(a.Images,function(a){return a.selected});_.each(c,function(a){var a=_.pick(a,"id","Key");b.Images.push(a)}),d.push(b)}),a.post("/api/slideshows/selections/",{selections:d})},b.getSelectedImageCount=function(){var a=b.albums,c=_.filter(a,function(a){return a.selected}),d=_.map(c,function(a){return _.filter(a.Images,function(a){return a.selected}).length});return b.stats.selectedImageCountByAlbum=_.map(a,function(a){return _.filter(a.Images,function(a){return a.selected}).length}),d.length>0?_.reduce(d,function(a,b){return a+b}):0}}]),angular.module("videogelApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("videogelApp").controller("SlideshowCtrl",["$scope",function(a){function b(a){console.log("it completed "+a)}function c(){console.log("wow file loaded")}function d(){j=window.createjs,h=document.getElementById("canvas"),k=document.getElementById("myform"),l=new j.Bitmap(k),l.x=0,l.y=0,i=new j.Stage(h),i.addChild(l),j.Ticker.setFPS(32),j.Ticker.addEventListener("tick",i)}function e(){l.scaleX=.4,l.scaleY=.4}function f(){j.Tween.get(l).to({scaleX:n,scaleY:n},p,q)}function g(){j.Tween.get(l).to({scaleX:o,scaleY:o},p,q)}var h,i,j,k,l,m=new createjs.LoadQueue(!0);m.on("complete",b),m.on("fileload",c),m.loadFile("images/deepspace.jpg"),d(),e();var n=.3,o=.5,p=3e3,q=j.Ease.cubicOut;a.ZITL=function(){e(),l.regX=0,l.regY=0,l.x=0,l.y=0,g()},a.ZITR=function(){e(),l.regX=l.getBounds().width,l.regY=0,l.x=h.width,l.y=0,g()},a.ZIBR=function(){e(),l.regX=l.getBounds().width,l.regY=l.getBounds().height,l.x=h.width,l.y=h.height,g()},a.ZIBL=function(){e(),l.regX=0,l.regY=l.getBounds().height,l.x=0,l.y=h.height,g()},a.ZOBR=function(){e(),l.regX=0,l.regY=0,l.x=0,l.y=0,f()},a.ZOBL=function(){e(),l.regX=l.getBounds().width,l.regY=0,l.x=h.width,l.y=0,f()},a.ZOTL=function(){e(),l.regX=l.getBounds().width,l.regY=l.getBounds().height,l.x=h.width,l.y=h.height,f()},a.ZOTR=function(){e(),l.regX=0,l.regY=l.getBounds().height,l.x=0,l.y=h.height,f()}}]);